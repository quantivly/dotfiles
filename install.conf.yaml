- defaults:
    link:
      relink: true
      create: true
      backup: true

- clean: ['~', '~/.config']

- link:
    ~/.config/gh/config.yml: gh/config.yml
    ~/.config/git/ignore: config/git/ignore
    ~/.config/git/hooks: config/git/hooks
    ~/.config/pypoetry/config.toml: config/pypoetry/config.toml
    ~/.gitconfig: gitconfig
    ~/.zshrc: zshrc
    ~/.p10k.zsh:
      path: p10k.zsh
      if: '[ -f p10k.zsh ]'

    # GPG utility scripts
    ~/.local/bin/gpg-prime-cache:
      path: scripts/gpg-prime-cache
      if: '[ -f scripts/gpg-prime-cache ]'
      create: true
      relink: true
      force: true
    ~/.local/bin/git-check-gpg-cache:
      path: scripts/git-check-gpg-cache
      if: '[ -f scripts/git-check-gpg-cache ]'
      create: true
      relink: true
      force: true
    ~/.local/bin/install-gpg-hooks:
      path: scripts/install-gpg-hooks
      if: '[ -f scripts/install-gpg-hooks ]'
      create: true
      relink: true
      force: true

- shell:
    - [git submodule update --init --recursive, Installing submodules]
    - |
      # Create ~/.zshrc.local if it doesn't exist
      if [ ! -f ~/.zshrc.local ]; then
        echo "Creating ~/.zshrc.local from template..."
        cp ~/.dotfiles/examples/zshrc.local.template ~/.zshrc.local
        chmod 600 ~/.zshrc.local
        echo "✓ Created ~/.zshrc.local with Quantivly environment documentation"
        echo "  Edit this file for machine-specific config (not tracked in git)"
      else
        echo "✓ ~/.zshrc.local already exists (preserving your customizations)"
      fi
    - |
      # Create ~/.gitconfig.local if it doesn't exist
      if [ ! -f ~/.gitconfig.local ]; then
        echo "Creating ~/.gitconfig.local from template..."
        cp ~/.dotfiles/gitconfig.local.example ~/.gitconfig.local
        chmod 600 ~/.gitconfig.local
        echo "Please edit ~/.gitconfig.local to add your git user information"
      fi
