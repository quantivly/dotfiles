- defaults:
    link:
      relink: true
      create: true
      backup: true

- clean: ['~', '~/.config']

- link:
    ~/.config/gh/config.yml: gh/config.yml
    ~/.config/git/ignore: config/git/ignore
    ~/.config/pypoetry/config.toml: config/pypoetry/config.toml
    ~/.config/Code/User/settings.json: vscode/settings.json
    ~/.config/helix/config.toml: helix/config.toml
    ~/.gitconfig: gitconfig
    ~/.tmux.conf: tmux.conf
    ~/.zshrc: zshrc
    ~/.p10k.zsh:
      path: p10k.zsh
      if: '[ -f p10k.zsh ]'

- shell:
    - [git submodule update --init --recursive, Installing submodules]
    - |
      # Create ~/.zshrc.local if it doesn't exist
      if [ ! -f ~/.zshrc.local ]; then
        echo "Creating ~/.zshrc.local from template..."
        cp ~/.dotfiles/examples/zshrc.local.template ~/.zshrc.local
        chmod 600 ~/.zshrc.local
        echo "✓ Created ~/.zshrc.local with Quantivly environment documentation"
        echo "  Edit this file for machine-specific config (not tracked in git)"
      else
        echo "✓ ~/.zshrc.local already exists (preserving your customizations)"
      fi
    - |
      # Create ~/.gitconfig.local if it doesn't exist
      if [ ! -f ~/.gitconfig.local ]; then
        echo "Creating ~/.gitconfig.local from template..."
        cp ~/.dotfiles/gitconfig.local.example ~/.gitconfig.local
        chmod 600 ~/.gitconfig.local
        echo "Please edit ~/.gitconfig.local to add your git user information"
      fi
    - |
      # Create SSH sockets directory for ControlMaster
      if [ ! -d ~/.ssh/sockets ]; then
        mkdir -p ~/.ssh/sockets
        chmod 700 ~/.ssh/sockets
        echo "✓ Created ~/.ssh/sockets for SSH connection multiplexing"
      fi
    - |
      # Install TPM (Tmux Plugin Manager) if not present
      if [ ! -d ~/.tmux/plugins/tpm ]; then
        git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
        echo "✓ Installed TPM (Tmux Plugin Manager)"
        echo "  Run 'prefix + I' inside tmux to install plugins"
      fi
